<!DOCTYPE html>
<html lang="ko" class="bg-slate-50">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2025-2 í¬ê³µ CCC ìˆœëŒ€ ì§ˆë¬¸ ë½‘ê¸° â€” ìŠ¤ì™€ì´í”„ ë²„ì „</title>

  <!-- Pretendard -->
  <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --card-radius:1.25rem;
      --shadow-soft:0 12px 40px rgba(15,23,42,.12);
      --easing:cubic-bezier(.2,0,.38,.9);
      --flip-ms:420ms;
    }
    body{font-family:Pretendard,system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif}

    /* ì¹´ë“œ ìŠ¤íƒ */
    .stack{
      position:relative;
      perspective:1200px;
      user-select:none;
    }
    .card{
      position:absolute; inset:0;
      display:grid; place-items:center;
      border-radius:var(--card-radius);
      box-shadow:var(--shadow-soft);
      background:white;
      overflow:hidden;
      will-change:transform,opacity;
      transition:transform var(--flip-ms) var(--easing), opacity 220ms var(--easing);
      touch-action:none; /* PointerEvent ë“œë˜ê·¸ ìœ„í•´ */
    }

    /* ì—­í•  ê¸°ë°˜ z-index */
    .card.top { z-index: 2; }
    .card.back { z-index: 1; }

    /* ê¸°ë³¸ì€ í° ì¹´ë“œë§Œ ë³´ì´ê²Œ */
    .card .card-bg { display: none; }
    /* ì•ˆë‚´(ì²˜ìŒ) ìƒíƒœì—ì„œë§Œ ë³´ë¼ìƒ‰ ë°°ê²½ ë…¸ì¶œ */
    .card.instruction .card-bg { display: block; }

    .card-bg{
      position:absolute; inset:0;
      background: radial-gradient(120% 120% at 0% 0%,
                  #a78bfa 0%, #6366f1 45%, #4338ca 100%);
    }
    .card-content{
      position:relative; z-index:1;
      padding:1.5rem;
      text-align:center;
      color:#0f172a;
    }
    .card.instruction .card-content{
      color:white;
    }
    .hidden-card{
      opacity:0; pointer-events:none;
    }

    /* ìŠ¤ì™€ì´í”„ ì¤‘ íšŒì „ ì‚´ì§ */
    .dragging{
      transition:none !important;
      cursor:grabbing;
    }

    /* ë‚ ì•„ê°€ëŠ” ì• ë‹ˆë©”ì´ì…˜(ë°©í–¥ë³„) */
    .fly-left{ transform: translateX(-130vw) rotate(-24deg) !important; opacity:0 !important; }
    .fly-right{ transform: translateX(130vw) rotate(24deg) !important; opacity:0 !important; }

    /* ì§„í–‰ë°” */
    .bar{ height:.5rem; background:#e2e8f0; border-radius:9999px; overflow:hidden; }
    .bar>span{ display:block; height:100%; background:#6366f1; width:0%; transition:width 200ms var(--easing); }

    /* ì ‘ê·¼ì„±: ëª¨ì…˜ ë¯¼ê° */
    @media (prefers-reduced-motion: reduce){
      .card{ transition: opacity 160ms ease }
      .fly-left,.fly-right{ transform:none !important; }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-5 md:p-8">

  <!-- í—¤ë” -->
  <header class="w-full max-w-3xl mb-6">
    <h1 class="text-2xl md:text-3xl font-semibold tracking-tight text-slate-900">
      2025-2 í¬ê³µ CCC ìˆœëŒ€ ì§ˆë¬¸ ë½‘ê¸°
    </h1>
    <p class="mt-2 text-slate-600 leading-relaxed">
      ì²˜ìŒì—” ì§ˆë¬¸ì´ ìˆ¨ê²¨ì ¸ ìˆì–´ìš”. í™”ë©´ì„ íƒ­/í´ë¦­í•˜ë©´ ì§ˆë¬¸ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
      ì¢Œ/ìš°ë¡œ ìŠ¤ì™€ì´í”„í•´ ì¹´ë“œë¥¼ ë„˜ê¸°ì„¸ìš”. (â†/â†’ í‚¤ë„ ê°€ëŠ¥)
    </p>
  </header>

  <!-- ìƒíƒœë°” -->
  <section class="w-full max-w-3xl mb-4">
    <div class="flex items-center justify-between text-sm text-slate-600">
      <div id="counter" class="font-medium">0 / 0</div>
      <button id="resetBtn"
        class="px-3 py-2 rounded-lg text-slate-700 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500"
        type="button" aria-label="ë‹¤ì‹œ ì„ê¸°">ë‹¤ì‹œ ì„ê¸°</button>
    </div>
    <div class="mt-2 bar rounded-full">
      <span id="progress"></span>
    </div>
  </section>

  <!-- ì¹´ë“œ ìŠ¤íƒ (ë§¨ ìœ„: .top, ì•„ë˜: .back) -->
  <main class="w-full max-w-3xl">
    <div id="stack" class="stack w-full aspect-[3/2] sm:aspect-[5/3]">
      <!-- Top card -->
      <div id="cardTop" class="card instruction top select-none" role="button" tabindex="0" aria-label="ì¹´ë“œ">
        <div class="card-bg"></div>
        <div class="card-content max-w-2xl">
          <div id="topText" class="text-xl md:text-2xl font-semibold leading-relaxed tracking-[-0.01em]">
            í™”ë©´ì„ ëˆŒëŸ¬ ì²« ì§ˆë¬¸ì„ ë³´ì—¬ì£¼ì„¸ìš” ğŸ‘‡
          </div>
        </div>
      </div>
      <!-- Back card (ì•„ë˜ ëŒ€ê¸°) -->
      <div id="cardNext" class="card back hidden-card select-none" aria-hidden="true">
        <div class="card-bg" style="opacity:.06"></div>
        <div class="card-content max-w-2xl">
          <div id="nextText" class="text-xl md:text-2xl font-semibold leading-relaxed tracking-[-0.01em] text-slate-900">
            <!-- ë‹¤ìŒ ì§ˆë¬¸ ë¯¸ë¦¬ ë¡œë“œ -->
          </div>
        </div>
      </div>
    </div>

    <!-- ì•¡ì…˜ -->
    <div class="mt-6 flex items-center gap-3">
      <button id="copyBtn"
        class="rounded-xl bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 px-4 py-3 font-medium shadow-sm border border-slate-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-slate-400"
        type="button">ì§ˆë¬¸ ë³µì‚¬</button>

      <span class="text-sm text-slate-500 ml-auto">
        ë‚¨ì€ ì¹´ë“œ <span id="remaining">0</span>ì¥
      </span>
    </div>

    <p id="endMsg" class="mt-6 hidden text-center text-slate-600">
      ëª¨ë“  ì§ˆë¬¸ì„ ë‹¤ ë½‘ì•˜ì–´ìš”! <span class="font-medium">ë‹¤ì‹œ ì„ê¸°</span>ë¥¼ ëˆŒëŸ¬ ìƒˆë¡œ ì‹œì‘í•˜ì„¸ìš”.
    </p>
  </main>

  <!-- ì§ˆë¬¸ ë°ì´í„° ë¨¼ì € ë¡œë“œ -->
  <script src="./questions.js"></script>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // ë°ì´í„°
    const questions = Array.isArray(window.QUESTIONS) ? window.QUESTIONS.slice() : [];

    // ìƒíƒœ
    let deck = [];
    let idx = -1;                 // -1: ì•„ì§ ì²« ì§ˆë¬¸ ë¯¸ê³µê°œ
    let isDragging = false;
    let startX = 0, startY = 0;
    let curX = 0, curY = 0;

    // ê³ ì • ì—˜ë¦¬ë¨¼íŠ¸(ì´ˆê¸° DOM)
    const stackEl     = document.getElementById('stack');
    const cardTopEl   = document.getElementById('cardTop');
    const topTextDom  = document.getElementById('topText');
    const cardNextEl  = document.getElementById('cardNext');
    const nextTextDom = document.getElementById('nextText');

    // ìŠ¤ì™‘ ê°€ëŠ¥í•œ í•¸ë“¤ (ì´ˆê¸°ì—ëŠ” ê³ ì • ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ê°€ë¦¬í‚´)
    let topCard   = cardTopEl;
    let backCard  = cardNextEl;
    let topTextEl = topTextDom;
    let backTextEl= nextTextDom;

    const counter   = document.getElementById('counter');
    const remaining = document.getElementById('remaining');
    const progress  = document.getElementById('progress');
    const resetBtn  = document.getElementById('resetBtn');
    const copyBtn   = document.getElementById('copyBtn');
    const endMsg    = document.getElementById('endMsg');

    // ìœ í‹¸
    const shuffle = (arr) => [...arr].sort(() => Math.random() - 0.5);

    function updateHUD() {
      const total = deck.length;
      const current = Math.max(idx, 0);
      counter.textContent = `${Math.min(current, total)} / ${total}`;
      remaining.textContent = Math.max(total - current, 0);
      const ratio = total ? Math.min(current / total, 1) : 0;
      progress.style.width = `${ratio * 100}%`;
      copyBtn.disabled = (idx < 0 || idx >= deck.length);
      copyBtn.classList.toggle('opacity-50', copyBtn.disabled);
      copyBtn.classList.toggle('pointer-events-none', copyBtn.disabled);
    }

    function resetDeck() {
      deck = shuffle(questions);
      idx = -1;
      endMsg.classList.add('hidden');

      // í´ë˜ìŠ¤ ì´ˆê¸°í™”: Topì€ ì•ˆë‚´(ë³´ë¼), Backì€ ìˆ¨ê¹€
      topCard.classList.add('instruction','top');
      topCard.classList.remove('back','hidden-card','fly-left','fly-right','dragging');
      backCard.classList.add('back','hidden-card');
      backCard.classList.remove('top','fly-left','fly-right','dragging');

      if (deck.length === 0) {
        topTextEl.textContent = 'ì§ˆë¬¸ ëª©ë¡ì´ ë¹„ì–´ ìˆì–´ìš”. questions.jsë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.';
        backTextEl.textContent = '';
        updateHUD();
        return;
      }

      topTextEl.textContent = 'í™”ë©´ì„ ëˆŒëŸ¬ ì²« ì§ˆë¬¸ì„ ë³´ì—¬ì£¼ì„¸ìš” ğŸ‘‡';
      backTextEl.textContent = deck[0]; // ì²« ì§ˆë¬¸ì„ ì•„ë˜ì— ì˜ˆì—´
      // ìœ„ì¹˜ ì´ˆê¸°í™”
      topCard.style.transform = '';
      topCard.style.opacity = '';

      updateHUD();
    }

    function revealFirst() {
      if (idx >= 0 || deck.length === 0) return;

      idx = 0;
      topTextEl.textContent = deck[0];
      topCard.classList.remove('instruction'); // ì´ì œë¶€í„° í° ì¹´ë“œë§Œ

      // ë‹¤ìŒ ì§ˆë¬¸ ë¯¸ë¦¬ ì±„ìš°ê¸°
      if (deck.length > 1) {
        backTextEl.textContent = deck[1];
        backCard.classList.add('back','hidden-card'); // ì•„ë˜ëŠ” ê¸°ë³¸ ìˆ¨ê¹€
      } else {
        backTextEl.textContent = '';
        backCard.classList.add('hidden-card');
      }
      updateHUD();
    }

    // í¬ì¸í„° ì œìŠ¤ì²˜
    function onPointerDown(e){
      // ì²« í„°ì¹˜ë¡œ 'ê³µê°œ + ë“œë˜ê·¸'ë¥¼ í•œ ë²ˆì—
      if (idx < 0){
        revealFirst();
        // return ì—†ì´ ì´ì–´ì„œ ë“œë˜ê·¸ ì‹œì‘
      }
      isDragging = true;
      startX = e.clientX ?? (e.touches && e.touches[0]?.clientX) ?? 0;
      startY = e.clientY ?? (e.touches && e.touches[0]?.clientY) ?? 0;
      topCard.classList.add('dragging');
      if (e.pointerId !== undefined) { topCard.setPointerCapture?.(e.pointerId); }
    }

    function onPointerMove(e){
      if (!isDragging) return;
      const x = e.clientX ?? (e.touches && e.touches[0]?.clientX) ?? startX;
      const y = e.clientY ?? (e.touches && e.touches[0]?.clientY) ?? startY;
      curX = x - startX;
      curY = y - startY;

      const rot = Math.max(Math.min(curX / 16, 24), -24);
      topCard.style.transform = `translate(${curX}px, ${curY}px) rotate(${rot}deg)`;
      topCard.style.opacity = `${Math.max(0.6, 1 - Math.abs(curX) / 600)}`;
    }

    function onPointerUp(){
      if (!isDragging) return;
      isDragging = false;
      topCard.classList.remove('dragging');

      const threshold = Math.min(window.innerWidth * 0.18, 200);
      if (curX > threshold){
        flyOut('right');
      } else if (curX < -threshold){
        flyOut('left');
      } else {
        topCard.style.transform = '';
        topCard.style.opacity = '';
      }
      curX = curY = 0;
    }

    function flyOut(direction){
      // ë‹¤ìŒ ì¹´ë“œê°€ ìˆìœ¼ë©´ ë¯¸ë¦¬ ì•„ë˜ ì¹´ë“œë¥¼ ë“œëŸ¬ë‚´ ìì—°ìŠ¤ëŸ¬ìš´ ë…¸ì¶œ
      const nextIdx = idx + 1;
      if (nextIdx < deck.length) {
        backCard.classList.remove('hidden-card');
      }

      // ìœ„ ì¹´ë“œ ë‚ ë¦¬ê¸°
      topCard.classList.add(direction === 'right' ? 'fly-right' : 'fly-left');

      const onEnd = () => {
        topCard.removeEventListener('transitionend', onEnd);

        // ë‚ ì•„ê°„ ì¹´ë“œ ë¦¬ì…‹ í›„ ë’¤ë¡œ ë³´ê´€
        topCard.classList.remove('fly-left','fly-right','dragging','top');
        topCard.classList.add('back','hidden-card');
        topCard.style.transform = '';
        topCard.style.opacity = '';

        // ğŸ” ì°¸ì¡° ìŠ¤ì™‘ (DOM ë‘ ì¥ì„ êµì°¨)
        [topCard, backCard]     = [backCard, topCard];
        [topTextEl, backTextEl] = [backTextEl, topTextEl];

        // ì—­í•  í´ë˜ìŠ¤ë„ êµì²´
        topCard.classList.remove('hidden-card','back');
        topCard.classList.add('top');
        backCard.classList.add('back');

        // ì¸ë±ìŠ¤ ì¦ê°€: ì´ì œ í™”ë©´ì˜ topCardëŠ” deck[idx+1]
        idx++;
        updateHUD();

        // ë ì²˜ë¦¬
        if (idx >= deck.length) {
          topTextEl.textContent = 'ë! ğŸ‰';
          endMsg.classList.remove('hidden');
          backTextEl.textContent = '';
          backCard.classList.add('hidden-card');
          return;
        }

        // ìƒˆë¡œìš´ ë’¤ ì¹´ë“œì— 'ë‹¤ë‹¤ìŒ' ì§ˆë¬¸ í”„ë¦¬ë¡œë“œ
        const upcoming = idx + 1;
        if (upcoming < deck.length) {
          backTextEl.textContent = deck[upcoming];
          backCard.classList.add('hidden-card'); // ì•„ë˜ëŠ” ê¸°ë³¸ ìˆ¨ê¹€
        } else {
          backTextEl.textContent = '';
          backCard.classList.add('hidden-card');
        }
      };
      topCard.addEventListener('transitionend', onEnd, { once:true });
    }

    // â¬‡â¬‡â¬‡ ì´ë²¤íŠ¸ ë°”ì¸ë”© (Delegate to #stack) â€” ì—¬ê¸°ë§Œ ë°”ë€Œì—ˆì–´ìš”!
    // top ì¹´ë“œê°€ ìŠ¤ì™‘ë˜ì–´ë„ í•­ìƒ ìµœì‹  .card.top ì—ì„œ ë“œë˜ê·¸ê°€ ì‹œì‘ë˜ë„ë¡ ì»¨í…Œì´ë„ˆì— ìœ„ì„
    ['pointerdown','touchstart'].forEach(evt => {
      stackEl.addEventListener(evt, (e) => {
        // ìŠ¤íƒ ì˜ì—­ ë‚´ì—ì„œë§Œ ì²˜ë¦¬, ê·¸ë¦¬ê³  top ì¹´ë“œ ìœ„ì—ì„œë§Œ ì‹œì‘
        const topEl = document.querySelector('.card.top');
        if (!topEl) return;
        if (!e.target.closest('.card.top')) {
          // ì´ˆê¸° ìƒíƒœì—ì„œ ì¹´ë“œ ì™¸ ì˜ì—­ì„ íƒ­í–ˆì„ ë•Œë„ ì²« ê³µê°œëŠ” ë˜ë„ë¡
          if (idx < 0) revealFirst();
          return;
        }
        onPointerDown(e);
      }, { passive: true });
    });

    // ì´ë™/í•´ì œëŠ” ì „ì—­ ìœ ì§€
    ['pointermove','touchmove'].forEach(evt => window.addEventListener(evt, onPointerMove, {passive:true}));
    ['pointerup','pointercancel','touchend','touchcancel'].forEach(evt => window.addEventListener(evt, onPointerUp, {passive:true}));

    // ë³µì‚¬
    copyBtn.addEventListener('click', async ()=>{
      try{
        const text = (idx >= 0 && idx < deck.length) ? deck[idx] : '';
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'ë³µì‚¬ë¨!';
        setTimeout(()=>copyBtn.textContent='ì§ˆë¬¸ ë³µì‚¬', 1200);
      }catch{
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.');
      }
    });

    // ë¦¬ì…‹
    resetBtn.addEventListener('click', resetDeck);

    // ì´ˆê¸°í™”
    resetDeck();
  </script>
</body>
</html>
