<!DOCTYPE html>
<html lang="ko" class="bg-slate-50">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>2025-2 포공 CCC 순대 질문 뽑기 — 새 디자인</title>

  <!-- Pretendard -->
  <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard-dynamic-subset.min.css" />
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --card-radius: 1.25rem;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, .10);
      --easing: cubic-bezier(.2, 0, .38, .9);
      --flip-ms: 500ms;
    }
    body { font-family: Pretendard, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif; }

    .card-3d { perspective: 1200px; }
    .card {
      position: relative; transform-style: preserve-3d;
      transition: transform var(--flip-ms) var(--easing);
      border-radius: var(--card-radius); box-shadow: var(--shadow-soft);
      cursor: pointer;
    }
    .card.is-flipped { transform: rotateY(180deg); }

    .card-face {
      position: absolute; inset: 0; display: grid; place-items: center;
      padding: 1.5rem; border-radius: inherit;
      backface-visibility: hidden; -webkit-backface-visibility: hidden;
    }
    .card-front {
      background: radial-gradient(120% 120% at 0% 0%, #a78bfa 0%, #6366f1 45%, #4338ca 100%);
      color: white;
    }
    .card-back { background: white; color: #0f172a; transform: rotateY(180deg); }

    @media (prefers-reduced-motion: reduce) {
      .card { transition: opacity 200ms ease; transform: none !important; }
      .card.is-flipped { opacity: 1; }
      .card-front, .card-back { transform: none !important; }
    }

    .tap-target { min-height: 48px; }
    .soft-transition { transition: all 180ms var(--easing); }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-5 md:p-8">

  <!-- 헤더 -->
  <header class="w-full max-w-3xl mb-6">
    <h1 class="text-2xl md:text-3xl font-semibold tracking-tight text-slate-900">
      2025-2 포공 CCC 순대 질문 뽑기
    </h1>
    <p class="mt-2 text-slate-600 leading-relaxed">
      카드를 눌러 뒤집고, <span class="font-medium text-slate-800">스페이스/엔터</span>로 다음 질문을 뽑을 수 있어요.
      <span class="text-slate-500">(Shift+Space: 뒤집기)</span>
    </p>
  </header>

  <!-- 상태바 -->
  <section class="w-full max-w-3xl mb-4">
    <div class="flex items-center justify-between text-sm text-slate-600">
      <div id="counter" class="font-medium">0 / 0</div>
      <button id="resetBtn"
              class="tap-target soft-transition px-3 py-2 rounded-lg text-slate-700 hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500"
              type="button" aria-label="다시 섞기">
        다시 섞기
      </button>
    </div>
    <div class="mt-2 h-2 w-full bg-slate-200 rounded-full overflow-hidden">
      <div id="progress" class="h-full bg-indigo-500 w-0"></div>
    </div>
  </section>

  <!-- 카드 -->
  <main class="w-full max-w-3xl">
    <div class="card-3d w-full aspect-[3/2] sm:aspect-[5/3]">
      <div id="card"
           class="card w-full h-full select-none"
           role="button" tabindex="0"
           aria-label="질문 카드 뒤집기 (엔터 키로 뒤집기)"
           aria-pressed="false">
        <div class="card-face card-front">
          <div class="text-center px-6">
            <div class="text-3xl md:text-4xl font-bold tracking-tight drop-shadow-sm">질문 카드 🧐</div>
            <p class="mt-3 text-white/90 md:text-lg">클릭/탭 또는 Enter로 뒤집기</p>
          </div>
        </div>
        <div class="card-face card-back">
          <div class="max-w-2xl text-center px-6">
            <p id="questionText"
               class="text-xl md:text-2xl font-semibold leading-relaxed tracking-[-0.01em]"
               aria-live="polite">
              질문을 뽑아 주세요!
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- 액션 영역 -->
    <div class="mt-6 flex flex-wrap items-center gap-3">
      <button id="drawBtn"
              class="tap-target soft-transition rounded-xl bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white px-5 py-3 font-semibold shadow-md focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500"
              type="button">
        질문 뽑기
      </button>

      <button id="flipBtn"
              class="tap-target soft-transition rounded-xl bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 px-4 py-3 font-medium shadow-sm border border-slate-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-slate-400"
              type="button">
        뒤집기
      </button>

      <button id="copyBtn"
              class="tap-target soft-transition rounded-xl bg-white hover:bg-slate-100 active:bg-slate-200 text-slate-900 px-4 py-3 font-medium shadow-sm border border-slate-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-slate-400"
              type="button">
        질문 복사
      </button>

      <span id="hint" class="text-sm text-slate-500 ml-auto">
        남은 카드 <span id="remaining">0</span>장
      </span>
    </div>

    <p id="endMsg" class="mt-6 hidden text-center text-slate-600">
      모든 질문을 다 뽑았어요! <span class="font-medium">다시 섞기</span>를 눌러 새로 시작하세요.
    </p>
  </main>

  <!-- 1) 질문 데이터: 반드시 먼저 로드 -->
  <script src="./questions.js"></script>

  <!-- 2) 앱 스크립트 -->
  <script>
    // --- 데이터 (questions.js에서 주입) ---
    const questions = Array.isArray(window.QUESTIONS) ? window.QUESTIONS : [];
    // --- 상태 ---
    let deck = [];
    let idx = -1;

    // --- 엘리먼트 ---
    const card = document.getElementById('card');
    const questionText = document.getElementById('questionText');
    const drawBtn = document.getElementById('drawBtn');
    const flipBtn = document.getElementById('flipBtn');
    const copyBtn = document.getElementById('copyBtn');
    const resetBtn = document.getElementById('resetBtn');
    const counter = document.getElementById('counter');
    const remaining = document.getElementById('remaining');
    const progress = document.getElementById('progress');
    const endMsg = document.getElementById('endMsg');

    // --- 유틸 ---
    const shuffle = (arr) => [...arr].sort(() => Math.random() - 0.5);

    function updateHUD() {
      const total = deck.length;
      const current = Math.min(Math.max(idx, 0), total);
      counter.textContent = `${Math.min(current, total)} / ${total}`;
      remaining.textContent = Math.max(total - current, 0);
      const ratio = total ? Math.min(current / total, 1) : 0;
      progress.style.width = `${ratio * 100}%`;
    }

    function setFront() {
      card.classList.remove('is-flipped');
      card.setAttribute('aria-pressed', 'false');
    }
    function setBack() {
      card.classList.add('is-flipped');
      card.setAttribute('aria-pressed', 'true');
    }

    function resetDeck() {
      deck = shuffle(questions);
      idx = -1;
      setFront();
      questionText.textContent = "질문을 뽑아 주세요!";
      endMsg.classList.add('hidden');
      drawBtn.textContent = '질문 뽑기';
      updateHUD();
    }

    function drawNext() {
      if (!card.classList.contains('is-flipped')) setBack();

      idx++;
      if (idx >= deck.length) {
        endMsg.classList.remove('hidden');
        drawBtn.textContent = '처음부터 다시';
        idx = deck.length;
        updateHUD();
        return;
      }
      questionText.textContent = deck[idx];
      drawBtn.textContent = '다음 질문 뽑기';
      updateHUD();
    }

    // --- 이벤트 ---
    card.addEventListener('click', () => {
      card.classList.toggle('is-flipped');
      const flipped = card.classList.contains('is-flipped');
      card.setAttribute('aria-pressed', flipped ? 'true' : 'false');
    });

    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { card.click(); }
    });

    drawBtn.addEventListener('click', () => {
      if (!card.classList.contains('is-flipped')) {
        setBack();
        setTimeout(drawNext, 120);
      } else {
        drawNext();
      }
    });

    flipBtn.addEventListener('click', () => card.click());

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(questionText.textContent.trim());
        copyBtn.textContent = '복사됨!';
        setTimeout(() => (copyBtn.textContent = '질문 복사'), 1200);
      } catch {
        alert('복사에 실패했어요. 브라우저 설정을 확인해 주세요.');
      }
    });

    resetBtn.addEventListener('click', resetDeck);

    window.addEventListener('keydown', (e) => {
      if (e.target.closest('input, textarea, button')) return;
      if (e.code === 'Space' && !e.shiftKey) { e.preventDefault(); drawBtn.click(); }
      if ((e.code === 'Space' && e.shiftKey) || e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
        e.preventDefault(); card.click();
      }
      if (e.key.toLowerCase() === 'r') resetDeck();
    });

    // 초기화
    resetDeck();
  </script>
</body>
</html>
